<!DOCTYPE html>
<html>
<head>
  <title>Blood Report QR Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, select {
      margin-bottom: 10px;
      display: block;
    }
    #downloadBtn {
      display: none;
      margin-top: 10px;
      padding: 6px 12px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #downloadBtn:hover {
      background-color: #0056b3;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

  <h2>Enter Blood Test Data</h2>
  <form id="reportForm">
    <strong>Personal Information</strong><br>
    Name: <input name="name" required><br>
    Age: <input type="number" name="age" required><br>
    Gender:
    <select name="gender" required>
      <option value="">Select</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select><br>
    Blood Group:
    <select name="bloodGroup" required>
      <option value="">Select</option>
      <option>A+</option>
      <option>A-</option>
      <option>B+</option>
      <option>B-</option>
      <option>AB+</option>
      <option>AB-</option>
      <option>O+</option>
      <option>O-</option>
    </select><br>
    Date of Test: <input type="date" name="testDate" required><br>

    <strong>Blood Test Values</strong><br>
    Hemoglobin: <input name="hb" required><br>
    WBC: <input name="wbc" required><br>
    Platelets: <input name="platelets" required><br>
    Glucose: <input name="glucose" required><br>
    Cholesterol: <input name="cholesterol" required><br>

    <button type="submit">Generate QR</button>
  </form>

  <div id="qrcode" style="margin-top: 20px;"></div>
  <button id="downloadBtn">Download QR</button>

  <script>
    const form = document.getElementById('reportForm');
    const downloadBtn = document.getElementById('downloadBtn');
    const qrContainer = document.getElementById('qrcode');

    let canvasRef = null;

    form.onsubmit = (e) => {
      e.preventDefault();

      const data = Object.fromEntries(new FormData(form).entries());
      const json = JSON.stringify(data);
      const base64 = btoa(json);

      // Your live report URL
      const url = `https://rajrishu1401.github.io/blood-report-qr/report.html?data=${base64}`;

      qrContainer.innerHTML = ''; // Clear any old QR
      canvasRef = document.createElement('canvas');
      qrContainer.appendChild(canvasRef);

      // Use QRCode library to draw on canvas
      new QRCode(canvasRef, {
        text: url,
        width: 256, // You can increase this for higher resolution
        height: 256,
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
      });

      downloadBtn.style.display = 'inline-block';
    };

    downloadBtn.onclick = () => {
      if (!canvasRef) {
        alert("Please generate the QR code first.");
        return;
      }

      const link = document.createElement("a");
      link.download = "blood-report-qr.png";
      link.href = canvasRef.toDataURL("image/png");
      link.click();
    };
  </script>

</body>
</html>
